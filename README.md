# rjson

[![godoc](https://pkg.go.dev/badge/github.com/willabides/rjson.svg)](https://pkg.go.dev/github.com/willabides/rjson)
[![ci](https://github.com/WillAbides/rjson/workflows/ci/badge.svg?branch=main&event=push)](https://github.com/WillAbides/rjson/actions?query=workflow%3Aci+branch%3Amain+event%3Apush)

rjson is a json parser that relies on [Ragel-generated](http://www.colm.net/open-source/ragel/) state machines for most
parsing. rjson's api is minimal and focussed on efficient parsing.

## Handle each byte once

What sets rjson apart performance-wise it that for the most part it handles each byte just once. For instance when
parsing a number some parsers will find the end of the number then send all the bytes to `strconv.ParseFloat` to be read
again. rjson calculates the value as it sees each byte so that by the time it encounters the end of the number it just
has to do one more calculation before returning a result.

There are only a few exceptions to this rule such as where the delimiter after a float is read by the parser described
above and again by the state machine.

## Ragel state machines

The handler and skip functions use state machines generated by Ragel. That is what lets rjson run recursive handlers
without double reading data.

## Standard Library Compatibility

rjson endeavors to decode json to the same values as the `encoding/json` functions. In the source code, most of rjson's
exported functions are followed by an unexported version that produces the same output using `encoding/json` instead 
of `rjson`. These are used to ensure compatibility.

#### The RuneError compatibility exception

When decoding strings, `encoding/json` will replace bytes with values over 127 that aren't part of a valid utf8 rune
with `utf8.RuneError`. I don't think this is correct behavior, and I have not found any other go json parser that does
this, so rjson keeps those bytes as-is when decoding strings.

If you need those RuneErrors, you can use `StdLibCompatibleString`, `StdLibCompatibleSlice`, and `StdLibCompatibleMap`.

## Differential Fuzz Testing

rjson uses fuzz testing extensively to test compatibility with `encoding/json`. See [fuzzers.go](./fuzzers.go) for 
the fuzz functions and [testdata/fuzz/corpus](./testdata/fuzz/corpus) for the increasingly unwieldy corpus.

## Benchmarks

Benchmark results with comparisons to other json parsers is in [benchmarks.md](./benchmarks.md).
